"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(e){function t(o,i){this.$element=e(o),this.options=e.extend({},t.DEFAULTS,e.isPlainObject(i)&&i),this.init()}var o="qor.collection.sortable",i=".qor-sortable__item",n=".qor-sortable__action";return t.prototype={constructor:t,init:function(){this.bind(),this.initItemOrder()},bind:function(){this.$element.on("click.qor.collection.sortable",e.proxy(this.click,this))},unbind:function(){this.$element.off("click.qor.collection.sortable",this.click)},initItemOrder:function(o){var r=this.$element.find(i).filter(":visible").not(".is-delete");if(r.size()){var l,s,a=r.find(n).find(".qor-sortable__action-position"),d={},c=r.size(),f=r.first().html();a.size()&&a.remove(),s||(l=f.match(/(\w+)\="(\S*\[\d+\]\S*)"/),l.length&&(l=l[2],s=l.match(/^(\S*)\[(\d+)\]([^\[\]]*)$/),s.length&&(s=s[1]))),r.each(function(i){var r=e(this),l=r.find(n);d.isSelected=!1,d.itemTotal=c,d.itemIndex=i+1,l.prepend('<select class="qor-sortable__action-position"></select>');for(var a=1;a<=c;a++)d.index=a,d.itemIndex==a?d.isSelected=!0:d.isSelected=!1,l.find("select").append(window.Mustache.render(t.OPTION_HTML,d));if(o){var f,u,b,h=/\[\d+\]/.test(s),m=e(this).find('[name^="'+s+'"]');if(!m.length)return;m.each(function(){f=e(this).prop("name"),b=f.match(/\.\w+$/),u="["+d.itemIndex+"]",f=h?f.replace(/\[\d+\]\.\w+$/,""+u+b):f.replace(/\[\d+\]/,u),e(this).prop("name",f)})}r.data(d)})}},moveItem:function(t){var o,n,r=t.closest(i),l=r.data().itemIndex,s=r.find(".qor-sortable__action-position").val();s!=l&&(o=1==s?1:s<l?s-1:s,n=this.$element.find(i).filter(function(){return e(this).data().itemIndex==o}),1==s?n.before(r.fadeOut("slow").fadeIn("slow")):n.after(r.fadeOut("slow").fadeIn("slow")),this.initItemOrder(!0))},click:function(t){var o=e(t.target),r=this.$element,l=r.find(i).filter(":visible").not(".is-delete");o.is(".qor-sortable__button-move")&&this.moveItem(o),o.is(".qor-sortable__button-done")&&(o.hide(),r.find(n).hide(),r.find(".qor-sortable__button-change").show(),r.find(".qor-sortable__button-add").show(),r.find(".qor-sortable__button-delete").show()),o.is(".qor-sortable__button-change")&&l.size()&&(o.hide(),r.find(".qor-sortable__button-done").show(),r.find(n).show(),r.find(".qor-sortable__button-add").hide(),r.find(".qor-sortable__button-delete").hide(),this.initItemOrder())},destroy:function(){this.unbind(),this.$element.removeData(o)}},t.DEFAULTS={},t.OPTION_HTML='<option value="[[index]]" [[#isSelected]]selected[[/isSelected]]>[[index]] of [[itemTotal]]</option>',t.plugin=function(i){return this.each(function(){var n,r=e(this),l=r.data(o);if(!l){if(/destroy/.test(i))return;r.data(o,l=new t(this,i))}"string"==typeof i&&e.isFunction(n=l[i])&&n.apply(l)})},e(function(){var o='[data-toggle="qor.collection.sortable"]';e("body").data("sortable-collection-loaded")||(e("body").data("sortable-collection-loaded",!0),e(document).on("disable.qor.collection.sortable",function(i){t.plugin.call(e(o,i.target),"destroy")}).on("enable.qor.collection.sortable",function(i){t.plugin.call(e(o,i.target))}).triggerHandler("enable.qor.collection.sortable"))}),t});