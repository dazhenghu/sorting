"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(e){function t(o,i){this.$element=e(o),this.options=e.extend({},t.DEFAULTS,e.isPlainObject(i)&&i),this.init()}var o="qor.collection.sortable",i="click."+o,n="> .qor-field__block > .qor-sortable__item",r=">.qor-sortable__button > .qor-sortable__button-change",s=">.qor-sortable__button > .qor-sortable__button-done",l=">.qor-field__block > .qor-sortable__item > .qor-sortable__change .qor-sortable__button-move",d="> .qor-sortable__change > .qor-sortable__action";return t.prototype={constructor:t,init:function(){this.bind(),this.initItemOrder()},bind:function(){this.$element.on(i,l,this.moveItem.bind(this)).on(i,s,this.finishMoveItem.bind(this)).on(i,r,this.startMoveItem.bind(this))},unbind:function(){this.$element.off(i,l,this.moveItem.bind(this)).off(i,s,this.finishMoveItem.bind(this)).off(i,r,this.startMoveItem.bind(this))},initItemOrder:function(o){var i=this.$element.find(n).not(".is-delete,.qor-fieldset--new");if(i.size()){var r,s,l=i.find(d).find(".qor-sortable__action-position"),a={},f=i.size(),c=i.first().html();l.size()&&l.remove(),s||(r=c.match(/(\w+)\="(\S*\[\d+\]\S*)"/),r.length&&(r=r[2],s=r.match(/^(\S*)\[(\d+)\]([^\[\]]*)$/),s.length&&(s=s[1]))),i.each(function(i){var n=e(this),r=n.find(d);a.isSelected=!1,a.itemTotal=f,a.itemIndex=i+1,r.prepend('<select class="qor-sortable__action-position"></select>');for(var l=1;l<=f;l++)a.index=l,a.itemIndex==l?a.isSelected=!0:a.isSelected=!1,r.find("select").append(window.Mustache.render(t.OPTION_HTML,a));if(o){var c,b,h,u=/\[\d+\]/.test(s),m=e(this).find('[name^="'+s+'"]');if(!m.length)return;m.each(function(){c=e(this).prop("name"),h=c.match(/\.\w+$/),b="["+a.itemIndex+"]",c=u?c.replace(/\[\d+\]\.\w+$/,""+b+h):c.replace(/\[\d+\]/,b),e(this).prop("name",c)})}n.data(a)})}},moveItem:function(t){var o=e(t.target).closest(".qor-sortable__item"),i=o.data().itemIndex,r=o.find(".qor-sortable__action-position").val(),s=void 0,l=void 0;r!=i&&(s=1==r?1:r<i?r-1:r,l=this.$element.find(n).filter(function(){return e(this).data().itemIndex==s}),1==r?l.before(o.fadeOut("slow").fadeIn("slow")):l.after(o.fadeOut("slow").fadeIn("slow")),this.initItemOrder(!0))},finishMoveItem:function(t){var o=e(t.target),i=this.$element,s=i.find(n).not(".is-delete,.qor-fieldset--new"),l=i.find("> .qor-field__block > .qor-sortable__button-add"),a=s.find("> .qor-sortable__button-delete"),f=s.find(d);o.hide(),f.hide(),i.find(r).show(),l.show(),a.show()},startMoveItem:function(t){var o=e(t.target),i=this.$element,r=i.find(n).not(".is-delete,.qor-fieldset--new"),l=i.find("> .qor-field__block > .qor-sortable__button-add"),a=r.find("> .qor-sortable__button-delete"),f=r.find(d);if(!r.size())return!1;o.hide(),i.find(s).show(),f.show(),l.hide(),a.hide(),this.initItemOrder()},destroy:function(){this.unbind(),this.$element.removeData(o)}},t.DEFAULTS={},t.OPTION_HTML='<option value="[[index]]" [[#isSelected]]selected[[/isSelected]]>[[index]] of [[itemTotal]]</option>',t.plugin=function(i){return this.each(function(){var n,r=e(this),s=r.data(o);if(!s){if(/destroy/.test(i))return;r.data(o,s=new t(this,i))}"string"==typeof i&&e.isFunction(n=s[i])&&n.apply(s)})},e(function(){var o='[data-toggle="qor.collection.sortable"]';e("body").data("sortable-collection-loaded")||(e("body").data("sortable-collection-loaded",!0),e(document).on("disable.qor.collection.sortable",function(i){t.plugin.call(e(o,i.target),"destroy")}).on("enable.qor.collection.sortable",function(i){t.plugin.call(e(o,i.target))}).triggerHandler("enable.qor.collection.sortable"))}),t});