"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function e(o,n){this.$element=t(o),this.options=t.extend({},e.DEFAULTS,t.isPlainObject(n)&&n),this.init()}var o="qor.collection.sortable",n="click."+o,i="> .qor-field__block > .qor-sortable__item",r=">.qor-sortable__button > .qor-sortable__button-change",l=">.qor-sortable__button > .qor-sortable__button-done",s=">.qor-field__block > .qor-sortable__item > .qor-sortable__change .qor-sortable__button-move",d="> .qor-sortable__change > .qor-sortable__action";return e.prototype={constructor:e,init:function(){this.bind(),this.initItemOrder()},bind:function(){this.$element.on(n,s,this.moveItem.bind(this)).on(n,l,this.finishMoveItem.bind(this)).on(n,r,this.startMoveItem.bind(this))},unbind:function(){this.$element.off(n,s,this.moveItem.bind(this)).off(n,l,this.finishMoveItem.bind(this)).off(n,r,this.startMoveItem.bind(this))},initItemOrder:function(o){var n=this.$element.find(i).not(".is-delete,.qor-fieldset--new");if(n.length){var r,l,s=n.find(d).find(".qor-sortable__action-position"),a={},f=n.length,c=n.first().html();s.length&&s.remove(),l||(r=c.match(/(\w+)\="(\S*\[\d+\]\S*)"/),r.length&&(r=r[2],l=r.match(/^(\S*)\[(\d+)\]([^\[\]]*)$/),l.length&&(l=l[1]))),n.each(function(n){var i=t(this),r=i.find(d);a.isSelected=!1,a.itemTotal=f,a.itemIndex=n+1,r.prepend('<select class="qor-sortable__action-position"></select>');for(var s=1;s<=f;s++)a.index=s,a.itemIndex==s?a.isSelected=!0:a.isSelected=!1,r.find("select").append(window.Mustache.render(e.OPTION_HTML,a));if(o){var c,h,b,u=/\[\d+\]/.test(l),m=t(this).find('[name^="'+l+'"]');if(!m.length)return;m.each(function(){c=t(this).prop("name"),b=c.match(/\.\w+$/),h="["+a.itemIndex+"]",c=u?c.replace(/\[\d+\]\.\w+$/,""+h+b):c.replace(/\[\d+\]/,h),t(this).prop("name",c)})}i.data(a)})}},moveItem:function(e){var o=t(e.target).closest(".qor-sortable__item"),n=o.data().itemIndex,r=o.find(".qor-sortable__action-position").val(),l=void 0,s=void 0;r!=n&&(l=1==r?1:r<n?r-1:r,s=this.$element.find(i).filter(function(){return t(this).data().itemIndex==l}),1==r?s.before(o.fadeOut("slow").fadeIn("slow")):s.after(o.fadeOut("slow").fadeIn("slow")),this.initItemOrder(!0))},finishMoveItem:function(e){var o=t(e.target),n=this.$element,l=n.find(i).not(".is-delete,.qor-fieldset--new"),s=n.find("> .qor-field__block > .qor-sortable__button-add"),a=l.find("> .qor-sortable__button-delete"),f=l.find(d);o.hide(),f.hide(),n.find(r).show(),s.show(),a.show()},startMoveItem:function(e){var o=t(e.target),n=this.$element,r=n.find(i).not(".is-delete,.qor-fieldset--new"),s=n.find("> .qor-field__block > .qor-sortable__button-add"),a=r.find("> .qor-sortable__button-delete"),f=r.find(d);if(!r.length)return!1;o.hide(),n.find(l).show(),f.show(),s.hide(),a.hide(),this.initItemOrder()},destroy:function(){this.unbind(),this.$element.removeData(o)}},e.DEFAULTS={},e.OPTION_HTML='<option value="[[index]]" [[#isSelected]]selected[[/isSelected]]>[[index]] of [[itemTotal]]</option>',e.plugin=function(n){return this.each(function(){var i,r=t(this),l=r.data(o);if(!l){if(/destroy/.test(n))return;r.data(o,l=new e(this,n))}"string"==typeof n&&t.isFunction(i=l[n])&&i.apply(l)})},t(function(){var o='[data-toggle="qor.collection.sortable"]';t("body").data("sortable-collection-loaded")||(t("body").data("sortable-collection-loaded",!0),t(document).on("disable.qor.collection.sortable",function(n){e.plugin.call(t(o,n.target),"destroy")}).on("enable.qor.collection.sortable",function(n){e.plugin.call(t(o,n.target))}).triggerHandler("enable.qor.collection.sortable"))}),e});