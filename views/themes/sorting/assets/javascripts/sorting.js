"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function o(n,e){this.$element=t(n),this.options=t.extend({},o.DEFAULTS,t.isPlainObject(e)&&e),this.$source=null,this.ascending=!1,this.orderType=0,this.startY=0,this.init()}var n=window.location,e="qor.sorting",i="enable."+e,r="disable."+e,s="change."+e,a="mousedown."+e,d="mouseup."+e,u="dragstart."+e,p="dragend."+e,f="dragover."+e,h="drop."+e,l="qor-sorting",c="qor-sorting__highlight",g="qor-sorting__hover",y="tbody > tr";return o.prototype={constructor:o,init:function(){var n,e=this.options,i=this.$element,r=i.find(y),s=0,a=0,d=0;t("body").addClass(l),i.find("tbody .qor-table__actions").append(o.TEMPLATE),r.each(function(o){var i=t(this).find(e.input).data("position");o>0&&(i>n?a++:a--),n=i,d=o}),a===d?s=1:-a===d&&(s=-1),this.$rows=r,this.orderType=s,this.bind()},bind:function(){var o=this.options;this.$element.on(s,o.input,t.proxy(this.change,this)).on(a,o.toggle,t.proxy(this.mousedown,this)).on(d,t.proxy(this.mouseup,this)).on(u,y,t.proxy(this.dragstart,this)).on(p,y,t.proxy(this.dragend,this)).on(f,y,t.proxy(this.dragover,this)).on(h,y,t.proxy(this.drop,this))},unbind:function(){this.$element.off(s,this.change).off(a,this.mousedown)},change:function(o){var n,e=this.options,i=this.orderType,r=this.$rows,s=t(o.currentTarget),a=s.closest("tr"),d=a.parent(),u=s.data(),p=u.position,f=parseInt(s.val(),10),h=f>p;r.each(function(){var o=t(this),r=o.find(e.input),s=r.data("position");s===f&&(n=o,h?1===i?n.after(a):-1===i&&n.before(a):1===i?n.before(a):-1===i&&n.after(a)),h?s>p&&f>=s&&r.data("position",--s).val(s):p>s&&s>=f&&r.data("position",++s).val(s)}),s.data("position",f),n||(h?1===i?d.append(a):-1===i&&d.prepend(a):1===i?d.prepend(a):-1===i&&d.append(a)),this.sort(a,{url:u.sortingUrl,from:p,to:f})},mousedown:function(o){this.startY=o.pageY,t(o.currentTarget).closest("tr").prop("draggable",!0)},mouseup:function(){this.$element.find(y).prop("draggable",!1)},dragend:function(){t(y).removeClass(g),this.$element.find(y).prop("draggable",!1)},dragstart:function(o){var n=o.originalEvent,e=t(o.currentTarget);e.prop("draggable")&&n.dataTransfer&&(n.dataTransfer.effectAllowed="move",this.$source=e)},dragover:function(o){var n=this.$source;t(y).removeClass(g),t(o.currentTarget).prev("tr").addClass(g),n&&o.currentTarget!==this.$source[0]&&o.preventDefault()},drop:function(o){var n,e,i,r,s,a,d=this.options,u=this.orderType,p=o.pageY>this.startY,f=this.$source;t(y).removeClass(g),f&&o.currentTarget!==this.$source[0]&&(o.preventDefault(),e=t(o.currentTarget),n=f.find(d.input),i=n.data(),r=i.position,s=e.find(d.input).data("position"),a=s>r,this.$element.find(y).each(function(){var o=t(this).find(d.input),n=o.data("position");a?n>r&&s>=n&&o.data("position",--n).val(n):r>n&&n>=s&&o.data("position",++n).val(n)}),n.data("position",s).val(s),a?1===u?e.after(f):-1===u?e.before(f):p?e.after(f):e.before(f):1===u?e.before(f):-1===u?e.after(f):p?e.before(f):e.after(f),this.sort(f,{url:i.sortingUrl,from:r,to:s}))},sort:function(o,e){var i=this.options;e.url&&(this.highlight(o),t.ajax(e.url,{method:"post",data:{from:e.from,to:e.to},success:function(t,n,e){200===e.status&&o.find(i.input).data("position",t).val(t)},error:function(t,o,e){422===t.status?window.QOR.qorConfirm(t.responseText,function(t){t&&n.reload()}):window.QOR.qorConfirm([o,e].join(": "),function(t){t&&n.reload()})}}))},highlight:function(t){t.addClass(c),setTimeout(function(){t.removeClass(c)},2e3)},destroy:function(){this.unbind(),this.$element.removeData(e)}},o.DEFAULTS={toggle:!1,input:!1},o.TEMPLATE='<a class="qor-sorting__toggle"><i class="material-icons">drag_handle</i></a>',o.plugin=function(n){return this.each(function(){var i,r=t(this),s=r.data(e);if(!s){if(/destroy/.test(n))return;r.data(e,s=new o(this,n))}"string"==typeof n&&t.isFunction(i=s[n])&&i.apply(s)})},t(function(){if(/sorting\=true/.test(n.search)){var e=".qor-js-table",s={toggle:".qor-sorting__toggle",input:".qor-sorting__position"};t(document).on(r,function(n){o.plugin.call(t(e,n.target),"destroy")}).on(i,function(n){o.plugin.call(t(e,n.target),s)}).trigger("disable.qor.slideout").triggerHandler(i)}}),o});